{% extends 'layout.html' %}
{% block title %}Mainkan Puzzle Custom{% endblock %}
{% block content %}
<h2 class="text-center mb-4"><i class="bi bi-joystick"></i> Mainkan Puzzle Buatanmu</h2>
<div id="custom-list-container"></div>
{% endblock %}
{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('custom-list-container');
        if (!window.mathPuzzle) {
            container.innerHTML = '<p class="text-center text-danger">Error: Gagal memuat main.js</p>';
            return;
        }
        const puzzles = window.mathPuzzle.getCustomPuzzles();
        if (puzzles.length === 0) {
            container.innerHTML = '<p class="text-center">Kamu belum membuat puzzle custom. <a href="/create">Buat sekarang!</a></p>';
            return;
        }
        puzzles.reverse().forEach(puzzle => {
            const card = document.createElement('div');
            card.className = 'card mb-3 animate-fade-in';
            card.innerHTML = `
                <div class="card-header"> <h5>${puzzle.title}</h5> </div>
                <div class="card-body">
                    <p class="fs-5">${puzzle.question}</p>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Ketik jawabanmu..." id="answer-${puzzle.id}">
                        <button class="btn btn-success" data-answer="${puzzle.simple_answer}" data-input-id="answer-${puzzle.id}">Cek</button>
                    </div>
                    <div class="feedback-container mt-2"></div>
                    <p class="mt-2 mb-0"><small>Hint: ${puzzle.hint}</small></p>
                </div>
            `;
            container.appendChild(card);
        });
        container.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.answer) {
                const btn = e.target;
                const feedbackEl = btn.closest('.card-body').querySelector('.feedback-container');
                const inputEl = document.getElementById(btn.dataset.inputId);
                if (inputEl.value.trim().toLowerCase() === btn.dataset.answer.toLowerCase()) {
                    feedbackEl.innerHTML = '<div class="alert alert-success">Benar!</div>';
                    inputEl.disabled = true;
                    btn.disabled = true;
                } else {
                    feedbackEl.innerHTML = '<div class="alert alert-danger">Salah!</div>';
                }
            }
        });
    });
</script>
{% endblock %}
